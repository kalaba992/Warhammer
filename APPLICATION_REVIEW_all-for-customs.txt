================================================================================
MAKSIMALNA REVIJA: all-for-customs Repository
================================================================================
Datum: Januar 13, 2026
Verzija: 1.0
Jezik: Srpski/Bosnian

================================================================================
EXECUTIVE SUMMARY
================================================================================

Projekat: Audit-grade HS customs classification system
Repository: github.com/kalaba992/all-for-customs

Opis: Multi-tenant React 19 + Convex backend, AI-asistencijom (GPT-4o), 
deterministiƒçkim GIR klasifikacijom, Evidence Bundlema sa JWS potpisima, 
i striktnom EU compliance (GDPR, ISO 27001, NIS2).

STANJE: 70% proizvodno, 30% u razvoju
OCENA: 6.5/10 - Solid prototype, trebuje 4-6 nedelja za production-ready

================================================================================
1. REPO STRUKTURA & KOMPLEKSNOST (‚≠ê‚≠ê‚≠ê‚≠ê)
================================================================================

POZITIVNE KARAKTERISTIKE:
‚úÖ Monorepo design sa jasnom separacijom
   - apps/frontend ‚Äî React 19 + Vite + shadcn/ui + TailwindCSS 4
   - apps/backend ‚Äî Convex DB + Node.js runtime
   - apps/api ‚Äî REST API v1 (OpenAPI v3)
   - packages/ ‚Äî Shared types, utils, evidence bundle logic
   - convex/ ‚Äî Core DB schema, functions, retrieval

‚úÖ Build & runtime: Turbo monorepo + npm workspaces, ESLint, TypeScript strict

‚úÖ Dokumentacija: 50+ guida (ARCHITECTURE.md, DEPLOYMENT.md, security policies)

PROBLEMI:
‚ùå Root je zapljusan: 100+ .md fajlove u rootu trebalo bi u /docs folder
‚ùå Turbo.json nedostaje kompletan config za build pipeline
‚ùå Duplicate Convex schema: convex/schema.ts i apps/convex/schema.ts - koji je 
   autoritativan?
‚ùå Nema CI/CD za deploy: GitHub Actions ima samo SBOM/SAST, nema build-test-deploy 
   pipeline


================================================================================
2. DATA MODEL & CONVEX BACKEND (‚≠ê‚≠ê‚≠ê)
================================================================================

≈†tinha JE DOBRO:

‚úÖ Well-designed schema:
   - Tenants ‚Äî multi-tenant RBAC foundation
   - Sources ‚Äî whitelist izvora sa trust levels
   - Documents ‚Äî full dokument metadata sa corpus_version tracking
   - Chunks ‚Äî granularna retrieval unit sa citation_id linkovima
   - Citations ‚Äî page/char locators za exact evidence sourcing
   - Evidence Bundles ‚Äî JWS stub za auditability
   - Decisions ‚Äî FINAL/STOP sa reasoning i citation trails
   - Tariff tables ‚Äî tariff_items (BiH HS codes) + tariff_measures (bilateral rates)

‚úÖ Proper indexing:
   - by_tenant_* na most tables (multi-tenant isolation)
   - by_corpus_version za versioning
   - Full-text search na chunks (Tantivy BM25)
   - by_code indexi na tariff tables

‚úÖ Corpus versioning ‚Äî Built-in sa corpus_version field (2026.1.0, 2026.2.0)

PROBLEMI:

‚ùå Tariff_items/measures nisu jo≈° popunjeni ‚Äî Schema je definisana, ali import je 
   blokiran (Convex CLI issue sa --table flag)

‚ùå Nema funkcija za tariff lookups ‚Äî Trebale bi convex/functions/tariff.ts queries:
   export const getTariffItem = query(async (ctx, { code }) => 
     ctx.db.query('tariff_items').withIndex('by_code', q => q.eq('code', code)).first()
   );

‚ùå Evidence Bundle schema ‚Äî JWS je stub (hsm_stub: { enabled: boolean, key_id }) 
   trebuje HSM integracija za production

‚ùå Nema soft-delete mechanism ‚Äî Trebali bi deleted_at field umjesto harddelete


================================================================================
3. FRONTEND APP (‚≠ê‚≠ê‚≠ê‚≠ê)
================================================================================

HIGHLIGHTS:

‚úÖ Conversational HS classification (src/components/HSChatClassifier.tsx):
   - Interactive stepwise classification 
     (chapter ‚Üí heading ‚Üí subheading ‚Üí subsubheading)
   - Confidence building via AI questions
   - Final Evidence Document generation
   - React 19 + hooks (useHSConversation, useStepwiseClassification)

‚úÖ Search UI (src/components/HSCodeSearch.tsx):
   - Live corpus search via retrieveEvidence (Convex) 
   - HS code extraction from snippets (regex)
   - Favorites (localStorage backed)
   - Multi-language support (Bosnian, Serbian, Cyrillic variant)

‚úÖ Evidence viewer (src/components/ClassificationDetailsPanel.tsx):
   - Full evidence breakdown per hierarchical level
   - Verifiable credential generation (VC JSON-LD)
   - Blockchain logging stub
   - Defensibility score display

‚úÖ UI kit ‚Äî shadcn/ui + TailwindCSS 4 + Radix (accessible)

PROBLEMI:

‚ùå Retrieval integration bug: HSCodeSearch poziva retrieveEvidence() koji je 
   src/lib/convexRetrieval.ts ‚Äî nije vidljivo kako se postavi Convex auth token. 
   Trebao bi JWT token flow.

‚ùå No tests ‚Äî Nema vitest/jest tests za components ili hooks. Trebalo bi:
   - Unit tests za useHSConversation, stepwise-hs-classification
   - Integration tests za HSCodeSearch retrieval
   - E2E tests sa Playwright/Cypress

‚ùå Hardcoded HS database ‚Äî src/lib/hsCodeDatabase.ts je mock sa samo 3-4 koda. 
   Trebalo bi dinamiƒçki load iz Convex (tariff_items tabela)

‚ùå Missing error handling ‚Äî No retry logic, timeout handling, graceful fallback 
   za Convex outage

‚ùå Auth0 stub incomplete ‚Äî apps/frontend/src/auth.ts ima template, ali nema 
   FIDO2, MFA validation


================================================================================
4. KB INGESTION PIPELINE (‚≠ê‚≠ê‚≠ê‚≠ê)
================================================================================

≈†T√ÅK RADI:

‚úÖ Two bundles already imported:
   - Bundle 1: 16 PDFs ‚Üí 2,186 citations/chunks (corpus 2026.1.0) ‚úÖ
   - Bundle 2: 36 PDFs ‚Üí 3,370 citations/chunks (corpus 2026.2.0) ‚úÖ
   - TOTAL: 52 documents, 5,556 chunks, searchable via BM25

‚úÖ Python parser (tools/convex_kb_zip_parser/parse_zip_to_convex_bundle.py):
   - Extracts PDFs from ZIP
   - Generates deterministic JSONL 
   - Calculates SHA256 hashes, page ranges, citation locators
   - Adds corpus_version, index_pending flags

‚úÖ TypeScript importer (tools/convex_kb_zip_parser/convex_import.ts):
   - Reads JSONL batch-by-batch
   - Enforces import order (documents ‚Üí citations ‚Üí chunks)
   - Uses Convex HTTP API, proper error handling

‚úÖ Smoke test (tools/smokeCheck.ts):
   - Verifies counts match izmeƒëu report.json i Convex
   - Hydrates 3 random chunks
   - PASSED for both bundles

≈†TO NEDOSTAJE:

‚ùå Tariff JSONL still pending import ‚Äî Files exist ali CLI blocked

‚ùå No incremental import ‚Äî If re-running parser, ƒáe duplicate data

‚ùå No failure recovery ‚Äî If import crashes midway, nema way to resume


================================================================================
5. API & INTEGRATIONS (‚≠ê‚≠ê‚≠ê)
================================================================================

STATUS: Partial ‚Äî REST API design documented, ali implementation incomplete

‚úÖ Health check (functions/api/diag.ts):
   - Checks Convex, OpenAI, Auth0 reachability
   - Returns deployment status

‚úÖ RBAC scaffold (apps/backend/src/rbac.ts):
   - Role definitions (admin, reviewer, user)
   - Permission matrix

‚ùå Missing core endpoints:
   - No /classify (submit product for HS classification)
   - No /evidence/{bundleId} (retrieve full evidence)
   - No /tariff/lookup/{code} (lookup HS rates)
   - No webhook handlers (Stripe, email)

‚ùå OpenAI integration ‚Äî src/lib/aiService.ts stubbed, no actual GPT-4o calls

‚ùå Auth0 incomplete ‚Äî Token validation not hooked, MFA flow missing


================================================================================
6. SECURITY & COMPLIANCE (‚≠ê‚≠ê‚≠ê‚≠ê)
================================================================================

≈†TO JE NA MJESTU:

‚úÖ SBOM Pipeline (.github/workflows/security-sbom.yml):
   - CycloneDX SBOM generation
   - npm audit, Snyk, Dependency-Check
   - ESLint SAST
   - OWASP ZAP DAST
   - Artifacts uploaded for audit trail

‚úÖ Security policies documented:
   - RBAC, MFA (TOTP + FIDO2), GDPR, ISO 27001/27701, NIS2
   - Data residency: EU only
   - Encryption at rest, TLS 1.3, mTLS, CSP headers

‚úÖ Auth0 template ‚Äî OIDC configured

‚úÖ Evidence signing stub ‚Äî JWS sa HSM/KMS placeholder

‚úÖ Audit trail ‚Äî Every decision logged sa citation_ids

PROBLEMI:

‚ùå HSM/KMS not integrated ‚Äî Evidence Bundle signing je STUB 
   Production trebuje Azure Key Vault ili AWS KMS

‚ùå FIDO2 missing ‚Äî WebAuthn flow nije integrated

‚ùå Rate limiting missing ‚Äî No tenant quotas, API rate limits

‚ùå Data residency not enforced ‚Äî No checks za EU regions only

‚ùå Secrets management unclear ‚Äî Nema .env.vault ili secret scanning


================================================================================
7. TESTING & QUALITY (‚≠ê‚≠ê)
================================================================================

≈†TA POSTOJI:

‚úÖ Contract tests scaffold (apps/backend/src/contracts/api.test.ts):
   - OpenAPI endpoint validation framework
   - Vitest runner

‚ùå No actual test coverage:
   - Frontend: 0% (no jest/vitest)
   - Backend: 0% (no Convex tests)
   - Integration: 0% (no E2E)
   - Target trebalo bi biti >80% za production

‚ùå No load testing ‚Äî k6, JMeter scripts for AI classification

‚ùå No chaos engineering ‚Äî What if Convex je down? OpenAI quota exceeded?


================================================================================
8. DEPLOYMENT & DEVOPS (‚≠ê‚≠ê)
================================================================================

≈†TA JE SETUP:

‚úÖ Cloudflare Pages (.github/workflows/cloudflare-pages.yml):
   - Auto-build i deploy na main push
   - Frontend artifacts uploaded

‚úÖ Environment templates (.env.example files)

‚ö†Ô∏è Convex dev mode available ‚Äî npx convex dev

‚ùå Production deployment undefined:
   - Nema Terraform/IaC za infrastructure
   - Nema database migration strategy
   - Nema secrets rotation policy
   - Nema backup/disaster recovery plan

‚ùå Monitoring/observability missing:
   - No Datadog, New Relic, Sentry
   - No structured logging (JSON)
   - No performance metrics (p50/p95/p99)


================================================================================
9. TARIFF DATA INTEGRATION (‚≠ê‚≠ê)
================================================================================

≈†TA JE GOTOVO:

‚úÖ Schema defined ‚Äî tariff_items i tariff_measures u Convex
‚úÖ JSONL files generated ‚Äî BiH 2026 tariff data ready
‚úÖ Automation scripts created:
   - scripts/tariff_complete_automation.py
   - scripts/tariff_import.sh
   - tools/complete_tariff_import.py

≈†TA NEDOSTAJE:

‚ùå Import not completed ‚Äî CLI blocked
‚ùå UI integration missing ‚Äî No component za tariff lookup
‚ùå Query functions missing ‚Äî No convex/functions/tariff.ts
‚ùå No fallback rates ‚Äî If tariff data missing, what rates?


================================================================================
10. GIR CLASSIFICATION ENGINE (‚≠ê‚≠ê‚≠ê)
================================================================================

WHAT'S DESIGNED:

‚úÖ Stepwise logic (src/lib/stepwise-hs-classification.ts):
   - Hierarchical classification
   - Confidence scoring per level
   - Rationale tracking
   - Evidence Document building

‚úÖ Hook interface (src/hooks/useStepwiseClassification.ts):
   - Async state management
   - Step completion checks
   - Confidence questions generation

‚ùå NO ACTUAL GIR RULES ENGINE ‚Äî GIR1-6 referenced u spec, ali:
   - No deterministic rule evaluation
   - No precedent matching (GIR3, GIR5)
   - No "essential character" logic (GIR2)
   - All sourced from AI helper (not rules-driven)

‚ùå No fallback to STOP ‚Äî Per spec, if confidence <70%, should return STOP + 
   wait 4-eyes review. Not implemented.


================================================================================
11. DOKUMENTACIJA (‚≠ê‚≠ê‚≠ê)
================================================================================

GOOD:

‚úÖ 50+ .md fajlove sa details
‚úÖ Architecture docs describing components
‚úÖ Runbooks for admin tasks

BAD:

‚ùå Not organized ‚Äî All in root, trebalo bi /docs hierarchy
‚ùå Some outdated ‚Äî TARIFF_SCRIPTS_README.md, FINALNI_GITHUB_VODIC.md
‚ùå No single source of truth ‚Äî QUICK_REFERENCE.md vs BRZI_VODIC.md
‚ùå Missing deployment checklist links


================================================================================
SVEOBUHVATNE PREPORUKE üéØ
================================================================================

KRITIƒåNO (Do 1 week):
----------------------------------

1. Complete tariff import:
   npx convex deploy
   npx convex import --deployment adorable-akita-878 --table tariff_items \
     --format jsonLines \
     "/Users/edinkalaba/Desktop/Desktop/bih_tariff_2026_convex_pack/bih_tariff_items_2026_convex.jsonl"
   npx convex import --deployment adorable-akita-878 --table tariff_measures \
     --format jsonLines \
     "/Users/edinkalaba/Desktop/Desktop/bih_tariff_2026_convex_pack/bih_tariff_measures_2026_convex.jsonl"

2. Add tariff query functions (convex/functions/tariff.ts)

3. Wire HSCodeSearch to real tariff_items (remove mock database)

4. Fix retrieval auth ‚Äî ensure Convex client has proper JWT/deployment token


HIGH (1-2 weeks):
----------------------------------

5. Implement core API endpoints 
   (POST /classify, GET /evidence/{id}, GET /tariff/{code})

6. Add 80+ test coverage (unit + integration)

7. Secure Auth0 ‚Äî enable MFA, FIDO2, role validation

8. GIR rules engine ‚Äî replace pure AI sa hybrid (rules + AI helper)

9. Observability ‚Äî Sentry, structured logging, performance metrics


MEDIUM (2-4 weeks):
----------------------------------

10. HSM/KMS integration ‚Äî replace stub sa Azure Key Vault/AWS KMS

11. Data residency checks ‚Äî ensure EU regions only

12. Backup & recovery strategy ‚Äî Convex snapshots, WARC archive restore

13. Organize docs ‚Äî Create /docs hierarchy, cleanup root

14. Load testing ‚Äî k6, Apache JMeter scripts


NICE-TO-HAVE:
----------------------------------

15. Rate limiting & quotas per tenant

16. Webhook integrations (Stripe, email)

17. Advanced monitoring (Datadog dashboards)

18. Mobile app (React Native or PWA)


================================================================================
JAƒåINE
================================================================================

‚úÖ Solid architecture (monorepo, Convex, React 19, multi-tenant)
‚úÖ Good security scaffolding (SBOM, Auth0, policies)
‚úÖ Strong documentation
‚úÖ Successful KB ingestion (52 docs, 5,556 chunks indexed)
‚úÖ Clean component design (React 19 + hooks)
‚úÖ Proper database schema with indexing
‚úÖ Audit trail logging built-in


================================================================================
SLABOSTI
================================================================================

‚ùå Production readiness 50% ‚Äî missing deploy pipeline, tests, observability
‚ùå Core API unimplemented
‚ùå Tariff import blocked
‚ùå GIR rules engine missing (pure AI fallback)
‚ùå HSM/signing is stub
‚ùå No test coverage (0%)
‚ùå Root folder is messy (100+ .md files)
‚ùå Auth0 integration incomplete
‚ùå No error handling/recovery
‚ùå Secrets management unclear


================================================================================
ZAKLJUƒåAK
================================================================================

OCENA: 6.5/10

Solid prototype sa dobar arhitekturom, ali trebuje 4-6 nedelja focused work 
za production-ready status.

PRIORITETI:
1. Tariff import completion
2. API implementation
3. Test coverage (80+%)
4. Auth0 + security hardening
5. Observability & monitoring
6. GIR rules engine (hybrid approach)
7. HSM/KMS integration

Za pitanja kontaktirajte: github.com/kalaba992/all-for-customs

================================================================================
END OF REVIEW
================================================================================
